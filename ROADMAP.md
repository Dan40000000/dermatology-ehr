Roadmap & Gap Tracker
=====================

Source inputs: ‚ÄúOpen-Source Dermatology EHR vs. Leading EHR Systems ‚Äì Comparative Analysis and PRD‚Äù and MODMED_FEATURE_COMPARISON.md. Goal: reach A+ parity/lead.

Legend: ‚úÖ done, üöß in progress, ‚è≥ planned, üî¥ missing

High Priority (Build Now)
-------------------------
- ‚úÖ Patient portal pre-check-in (start/complete check-in before arrival)
- ‚úÖ Face sheets (printable patient summary from schedule/encounter)
- ‚úÖ Waitlist with auto-fill/cancel handling and notifications
- ‚úÖ ePA (electronic prior auth) for prescriptions
- ‚úÖ Fax management (send/receive; queue UI)
- ‚úÖ Time blocks on schedule (non-patient slots; provider/location aware)

Medium Priority (V2)
--------------------
- ‚úÖ Patient handout library (condition/treatment education; assign to patient)
- ‚úÖ Advanced note management (preliminary/final filters, bulk finalize/assign, include visit code)
- ‚úÖ Rx workflows: refill denied tracking, change requests, audit confirmation
- ‚úÖ Direct mail/Direct secure messaging for provider-to-provider
- ‚úÖ Clearinghouse/ERA/EFT integration (claims submission, remits, reconciliation, closing reports)
- ‚úÖ Regulatory reporting / CQM (MIPS/quality registry hooks)
- ‚úÖ E-Prescribing with pharmacy network integration (Surescripts/NCPDP simulation)
- üî¥ Referral contacts network (manage specialists, referral tracking)

Lower Priority / Future
-----------------------
- ‚è≥ Compliance dashboard (analytics tab)
- ‚è≥ Portal enhancements: full self-scheduling, bill pay, intake/eCheck-in, family access
- ‚è≥ Telehealth video UX polish (if needed beyond current)
- ‚è≥ Ambient AI scribe during live visits (beyond current transcription + drafting)
- ‚è≥ Mobile-native apps; offline-friendly provider mode
- ‚è≥ Performance/scale hardening (queues for AI, rate limits per AI endpoint, observability)
- ‚è≥ Lab/Rad integrations beyond current manual orders

Status vs MODMED comparison (selected highlights)
-------------------------------------------------
- ‚úÖ Scheduling/office flow/appt flow core
- ‚úÖ Orders/labs/radiology basics; üîÑ missing advanced workflow states (pending plan/unresolved moves)
- ‚úÖ Notes/templates with advanced bulk actions (finalize/assign, sign, addendums)
- ‚úÖ Billing/claims with clearinghouse/ERA/closing reports
- ‚úÖ Text messages (advantage) - ENHANCED with templates, bulk sending, and scheduling
- ‚úÖ Body diagram & photos (advantage)
- ‚úÖ Patient portal baseline; üîÑ richer self-service/bill pay/intake
- ‚úÖ Waitlist with auto-fill and notifications
- ‚úÖ ePA (electronic prior auth)
- ‚úÖ Fax management (advantage)
- ‚úÖ Time blocks on schedule
- ‚úÖ Patient handout library (advantage)

Next Steps
----------
1) All High Priority features complete! Focus on Medium Priority list.
2) Wire tasks into issue tracker; add acceptance criteria per feature.
3) Add tests (unit/integration) per new module; mock external services (clearinghouse).
4) Re-run lint/tests after each milestone; add monitoring for new services.

Recent Completions
------------------
- ‚úÖ E-Prescribing with Pharmacy Network Integration - FULL IMPLEMENTATION (2025-12-29)
  - Simulates Surescripts/NCPDP network connectivity for electronic prescriptions
  - Backend: Complete pharmacy network and Rx history system
  - Database migrations (030_eprescribing.sql, 031_pharmacy_seed_data.sql):
    - Enhanced pharmacies table with NCPDP IDs, chains, hours, geolocation, capabilities
    - rx_history table - dispensed medications from all pharmacies (simulated Surescripts data)
    - prescription_transmissions table - tracks eRx sending status and NCPDP messages
    - formulary table - insurance preferred drugs and tier information
    - patient_benefits table - pharmacy insurance coverage details
    - drug_interactions table - drug-drug interaction database
    - patient_allergies table - allergy tracking for safety
    - surescripts_transactions table - log of all network transactions
  - Pharmacy Seed Data:
    - 20 major pharmacy chain locations (CVS, Walgreens, Walmart, Rite Aid, Kroger, Publix, Target, Costco, Sam's Club)
    - Real NCPDP identifiers, addresses, phone/fax, hours of operation
    - Geolocation data for distance calculations
    - Chain affiliations and capabilities (new_rx, refills, rx_change, rx_cancel)
  - Mock Surescripts Service (surescriptsService.ts):
    - sendNewRx() - transmit prescription to pharmacy (95% success rate simulation)
    - getRxHistory() - retrieve patient medication history from all pharmacies
    - checkFormulary() - insurance formulary and tier checking
    - getPatientBenefits() - pharmacy insurance coverage lookup
    - cancelRx() - cancel prescription transmission
    - checkDrugInteractions() - safety checking for interactions
    - Realistic network delays and response simulations
    - NCPDP SCRIPT message formatting
  - Backend Routes:
    - Pharmacies (/api/pharmacies):
      - GET /search - enhanced search by name, city, state, zip, chain, NCPDP ID
      - GET /nearby - find pharmacies near location (lat/long or address)
      - GET /ncpdp/:ncpdpId - lookup pharmacy by NCPDP identifier
      - Distance calculation using Haversine formula
    - Rx History (/api/rx-history):
      - GET /:patientId - complete medication history from all pharmacies
      - GET /patient/:patientId/summary - grouped medication summary
      - POST / - manually add Rx history record
      - POST /import-surescripts/:patientId - import from Surescripts network
      - DELETE /:id - delete Rx history record
    - Prescriptions (enhanced /api/prescriptions):
      - POST /send-erx - send prescription to pharmacy via NCPDP
      - POST /check-formulary - check insurance formulary status
      - GET /patient-benefits/:patientId - get pharmacy insurance benefits
  - Frontend API Functions:
    - searchPharmacies() - search by multiple criteria
    - getNearbyPharmacies() - location-based search
    - getPharmacyByNcpdp() - NCPDP lookup
    - getPatientRxHistory() - complete medication history
    - importSurescriptsRxHistory() - import from network
    - sendElectronicRx() - transmit prescription electronically
    - checkFormulary() - formulary and tier checking
    - getPatientBenefits() - insurance coverage lookup
  - Key Features:
    - Electronic prescription transmission with 95% success simulation
    - Complete medication history from all pharmacies (Surescripts RxHistoryRequest)
    - Insurance formulary checking with tier and copay information
    - Patient pharmacy benefits and coverage details
    - Drug interaction checking
    - Pharmacy search by name, location, chain, NCPDP
    - Distance-based pharmacy finder (nearby pharmacies)
    - Prescription transmission tracking and status
    - NCPDP SCRIPT message formatting
    - Audit trail for all transactions
  - Production-Ready Features:
    - Comprehensive transaction logging
    - Error handling and retry logic
    - Network delay simulation
    - Formulary tier system (1-5) with copay amounts
    - Prior authorization and step therapy flags
    - Quantity limits and alternatives
    - Deductible and out-of-pocket tracking
    - Multi-pharmacy history aggregation

- ‚úÖ Text Messaging Enhancements - FULL IMPLEMENTATION (2025-12-29)
  - Backend: Complete message templates and scheduling system
  - Database migration 030_sms_templates_scheduling with 2 new tables:
    - sms_message_templates - reusable message templates with categories and variable support
    - sms_scheduled_messages - future message scheduling with recurrence patterns
  - Message Templates:
    - CRUD operations for custom templates
    - 8 pre-seeded system templates (appointment reminders, lab results, instructions, etc.)
    - Categories: appointment_reminder, follow_up, instructions, education, general
    - Variable substitution: {firstName}, {lastName}, {patientName}, {providerName}, {clinicPhone}
    - Usage tracking (count and last used timestamp)
    - System templates cannot be deleted but can be activated/deactivated
  - Backend routes (/api/sms):
    - GET /templates - list templates with category and active filters
    - POST /templates - create new template
    - PATCH /templates/:id - update template (name, description, body, category, active status)
    - DELETE /templates/:id - delete custom templates (system templates protected)
    - POST /send-bulk - send to multiple patients immediately or schedule
    - GET /scheduled - list scheduled messages with status filter
    - POST /scheduled - create scheduled message with recurrence support
    - DELETE /scheduled/:id - cancel scheduled message
  - Bulk Messaging:
    - Select multiple patients via checkbox interface
    - Send same message to all selected recipients
    - Template integration for quick message creation
    - Variable substitution per patient (personalized messages)
    - Send immediately or schedule for later
    - Results tracking (total sent, failed counts)
    - Opt-out compliance checks per patient
  - Message Scheduling:
    - Schedule messages for future sending with date/time picker
    - Recurring message campaigns (daily, weekly, biweekly, monthly)
    - Recurrence end date support
    - Status tracking (scheduled, sending, sent, failed, cancelled)
    - Cancel scheduled messages before sending
    - Bulk scheduling for multiple recipients
    - Template integration for scheduled messages
  - Frontend API functions with credentials: 'include':
    - fetchSMSTemplates() - get templates with filtering
    - createSMSTemplate(), updateSMSTemplate(), deleteSMSTemplate()
    - sendBulkSMS() - immediate or scheduled bulk sending
    - fetchScheduledMessages(), createScheduledMessage(), cancelScheduledMessage()
  - Enhanced TextMessagesPage with 4-tab interface:
    - Messages Tab:
      - Conversation view with patient list sidebar
      - Template selector with quick insert
      - Character count and SMS segment calculator
      - Message status indicators (sent ‚úì, delivered ‚úì‚úì, failed ‚úó)
      - Real-time message polling (5s for active conversation, 10s for patient list)
      - Unread message badges
      - Last message preview in patient list
      - Search/filter patients
    - Templates Tab:
      - Grid view of all templates with usage stats
      - Create/edit/delete custom templates
      - System template protection (can't delete, can activate/deactivate)
      - Category badges and visual organization
      - Template modal with category selector
      - Character count and SMS segment preview
      - Variable helper text
    - Bulk Send Tab:
      - Patient selection panel with checkboxes
      - Selected patient count display
      - Template dropdown for quick message selection
      - Message composer with variable support
      - Character count and SMS segment calculator
      - Variable substitution preview
      - Confirmation before sending
      - Results notification (sent/failed counts)
    - Scheduled Tab:
      - List of scheduled and completed messages
      - Status badges (scheduled, sent, cancelled, failed)
      - Recurring message indicators
      - Send time display with local formatting
      - Cancel scheduled messages
      - Delivery statistics for sent messages
      - Schedule modal with patient multi-select
      - Template integration
      - Recurrence pattern selector
      - Date/time picker for scheduling
  - Production-ready features:
    - Complete audit trail for all template and messaging operations
    - User attribution (created_by for templates and scheduled messages)
    - System template protection (can't delete core templates)
    - Template usage analytics
    - Character counting with SMS segment calculation
    - Variable substitution engine
    - Opt-out compliance enforcement
    - Status tracking for all scheduled messages
    - Recurrence pattern support for campaigns
    - Template categories for organization
    - Active/inactive toggle for templates
    - Bulk operation error handling
    - Individual patient opt-out checking
    - Failed message tracking

- ‚úÖ Clearinghouse/ERA/EFT Integration - FULL IMPLEMENTATION (2025-12-29)
  - Backend: Complete claims submission, remittance advice, and payment reconciliation
  - Database migration 029_clearinghouse.sql with 7 new tables:
    - clearinghouse_submissions - track claim submissions with batch ID and control numbers
    - remittance_advice - ERA header records with payment amounts and check details
    - era_claim_details - line-level claim payment details from ERAs
    - eft_transactions - electronic funds transfers with reconciliation status
    - payment_reconciliation - variance tracking between ERA and EFT
    - clearinghouse_batches - batch submission management
    - closing_reports - daily/weekly/monthly closing report snapshots
  - Backend routes (/api/clearinghouse):
    - POST /submit-claim - submit claims to clearinghouse (mock implementation with random accept/reject/pending)
    - GET /claim-status/:claimId - check submission status with timeline
    - GET /era - list electronic remittance advice with filters (status, payer, date range)
    - GET /era/:id - get detailed ERA with claim-level breakdown
    - POST /era/:id/post - post ERA payments to claims (creates claim_payments records)
    - GET /eft - list EFT transactions with reconciliation filters
    - POST /reconcile - reconcile ERA with EFT, calculate variances
    - GET /reports/closing - generate closing reports (daily/weekly/monthly)
  - Frontend API functions with credentials: 'include':
    - submitClaimToClearinghouse(), fetchClaimStatus(), fetchRemittanceAdvice()
    - postERA(), fetchERADetails(), fetchEFTTransactions()
    - reconcilePayments(), fetchClosingReport()
  - Frontend ClearinghousePage with 5 tabs:
    - Submit Claims: Batch submission with checkbox selection, status timeline
    - ERA: List view with filters, detail panel, post to claims functionality
    - EFT: Transaction history with reconciliation status
    - Reconciliation: ERA-to-EFT matching, variance calculation, alerts
    - Reports: Closing report generation with date range selector
  - Features:
    - Mock clearinghouse responses (accept/reject/pend) for testing
    - Complete payment variance tracking and alerts
    - CSV export for ERAs, EFTs, and reports
    - Print-to-PDF for closing reports
    - Real-time status updates and submission timeline
    - Automatic claim status updates when fully paid via ERA
  - Production-ready compliance:
    - Complete audit trail for all submissions
    - Variance alerts for payment mismatches
    - Daily/weekly/monthly closing report snapshots

- ‚úÖ Advanced Rx Workflows - FULL IMPLEMENTATION (2025-12-29)
  - Backend: Complete refill tracking and change request management
  - GET /api/prescriptions/refill-requests - list all refill requests with filters (status, patient)
  - POST /api/prescriptions/:id/refill-deny - deny refill with structured reason codes
  - POST /api/prescriptions/:id/change-request - request medication changes with type and details
  - POST /api/prescriptions/:id/audit-confirm - confirm prescription review for compliance
  - Database schema enhancements:
    - refill_status field (approved, denied, pending, change_requested)
    - denial_reason field for tracking denial justifications
    - change_request_details field (JSON) for change history
    - audit_confirmed_at and audit_confirmed_by fields for compliance tracking
  - Frontend API functions with credentials: 'include':
    - fetchRefillRequests() with status and patient filtering
    - denyRefill(), requestMedicationChange(), confirmAudit()
  - Enhanced PrescriptionsPage UI:
    - Dual-tab interface: "All Prescriptions" and "Refill Requests"
    - Refill Requests tab with pending count badge
    - "Deny Refill" modal with reason selector:
      - Contraindication
      - Step Therapy Required
      - Formulary Issue
      - Prior Authorization Required
      - Maximum Refills Reached
      - Medication Discontinued
      - Patient Needs Evaluation
      - Other (with notes field)
    - "Request Change" modal with change types:
      - New Medication
      - Dosage Change
      - Frequency Change
      - Generic Substitution
      - Brand Name Required
    - "Audit Confirm" button for compliance review
    - Audit confirmation column showing confirmed status with checkmark
    - Status badges for refill status (approved, denied, pending, change_requested)
    - Change request history timeline in table
    - Denial reason display in refill requests
  - Production-ready compliance features:
    - Complete audit trail in prescription_audit_log
    - All denials tracked with reasons and timestamps
    - All changes tracked with justifications
    - Regulatory compliance ready for HIPAA/DEA audits
    - User attribution for all actions (created_by, updated_by, confirmed_by)
    - IP address logging for security audit

- ‚úÖ Time Blocks on Schedule - FULL IMPLEMENTATION (2025-12-29)
  - Backend: Complete time block management with all CRUD endpoints
  - GET /api/time-blocks - list time blocks with filters (provider, location, date range)
  - POST /api/time-blocks - create new time block (lunch, meeting, blocked, admin, etc.)
  - PATCH /api/time-blocks/:id - update time block details
  - DELETE /api/time-blocks/:id - soft delete (marks as cancelled)
  - Database schema with recurrence support:
    - Block types: blocked, lunch, meeting, admin, continuing_education, out_of_office
    - Recurrence patterns: daily, weekly, biweekly, monthly
    - Provider and location associations
    - Start/end times with timezone support
    - Status tracking (active/cancelled)
  - Frontend API functions with credentials: 'include':
    - fetchTimeBlocks() with filtering options
    - createTimeBlock(), updateTimeBlock(), deleteTimeBlock()
  - Enhanced SchedulePage UI:
    - "Block Time" button in action bar
    - Time block creation modal with all options
    - Recurrence configuration (pattern and end date)
    - Visual distinction from patient appointments
  - Calendar component enhancements:
    - Time blocks display with color coding by type:
      - Lunch: amber (#fbbf24)
      - Meeting: blue (#60a5fa)
      - Admin: purple (#a78bfa)
      - Continuing Education: green (#34d399)
      - Out of Office: red (#f87171)
      - Blocked: gray (#9ca3af)
    - Click to delete time blocks
    - Prevents appointment booking conflicts
    - Provider-specific filtering
    - Opacity differentiation (70%) from appointments
  - Production-ready features:
    - Conflict prevention with appointments
    - Recurring time block support
    - Audit trail (created_by, created_at, updated_at)
    - Multi-provider support
    - Location-aware blocking

- ‚úÖ Advanced Note Management - FULL IMPLEMENTATION (2025-12-29)
  - Backend: Complete note management with comprehensive workflow support
  - GET /api/notes - list notes with advanced filtering (status, provider, date range, patient)
  - POST /api/notes/bulk/finalize - finalize multiple notes at once
  - POST /api/notes/bulk/assign - assign multiple notes to provider
  - PATCH /api/notes/:id/sign - sign and lock note (prevents editing)
  - PATCH /api/notes/:id/addendum - add addendum to signed note
  - GET /api/notes/:id/addendums - retrieve all addendums for a note
  - Database schema enhancements:
    - Note status field (draft, preliminary, final, signed)
    - visit_code association for billing integration
    - signed_at and signed_by fields for compliance
    - note_addendums table for audit trail
    - Addendum tracking with timestamps and attribution
  - Frontend API functions with credentials: 'include':
    - fetchNotes() with comprehensive filtering
    - bulkFinalizeNotes(), bulkAssignNotes()
    - signNote(), addNoteAddendum(), fetchNoteAddendums()
  - New NotesPage UI with enterprise features:
    - Advanced filter panel:
      - Status filter (draft, preliminary, final, signed)
      - Provider filter (all providers dropdown)
      - Patient filter (searchable patient list)
      - Date range filter (start/end dates)
      - Apply filters and clear filters buttons
    - Bulk operations toolbar:
      - Checkbox selection for multiple notes
      - Select all / clear selection
      - "Finalize Selected" button (bulk status update)
      - "Assign Selected" button (bulk provider reassignment)
      - Selection count display
      - Disabled for signed notes (compliance)
    - Notes table with comprehensive columns:
      - Patient name (last, first)
      - Provider name
      - Chief complaint
      - Visit code (billing integration)
      - Status badge with color coding:
        - Draft: gray
        - Preliminary: blue
        - Final: green
        - Signed: purple
      - Date created
      - Actions column (view, sign, addendum)
    - Sign note workflow:
      - Confirmation modal with note preview
      - Patient and chief complaint display
      - Warning about locking note
      - Sign button with loading state
      - Prevents re-signing already signed notes
      - Provider-only access (RBAC enforced)
    - Addendum workflow for signed notes:
      - Modal with rich text area
      - Timestamp and attribution automatically added
      - Stored in separate table for audit trail
      - Display in note view with special formatting
      - Yellow highlight for addendums
    - View note modal:
      - Full note display with all sections
      - Chief complaint, HPI, ROS, exam, assessment & plan
      - Status badge and visit code
      - Patient and provider information
      - Addendums section (for signed notes)
      - Addendum history timeline
      - Added by and timestamp for each addendum
    - Bulk assign modal:
      - Provider dropdown selection
      - Selected notes count display
      - Validation before assignment
      - Prevents reassignment of signed notes
  - Production-ready compliance features:
    - Complete audit trail for all note operations
    - Signed notes are locked (read-only)
    - Only addendums can be added to signed notes
    - Provider-only signing (RBAC middleware)
    - User attribution for all actions
    - Timestamp tracking for signing and addendums
    - Prevents modification after signing (compliance)
    - Addendum table with full audit trail
    - Note ownership validation (providers sign own notes)
    - Admin override capability for bulk operations

- ‚úÖ ePA (Electronic Prior Authorization) - FULL IMPLEMENTATION (2025-12-29)
  - Backend: POST /api/prior-auth/:id/submit - submit to payer with mock integration
  - Backend: POST /api/prior-auth/:id/documents - upload supporting documents
  - Backend: GET /api/prior-auth/:id/status - check status with payer and timeline
  - Backend: POST /api/prior-auth/webhook/payer-response - webhook for payer responses
  - Status workflow: draft ‚Üí pending ‚Üí submitted ‚Üí approved/denied/more_info_needed
  - Mock payer integration with 2-second delay and randomized responses:
    - 60% approval rate with insurance auth numbers
    - 20% denial rate with step therapy requirements
    - 20% more info needed with specific documentation requests
  - Frontend API functions with credentials: 'include':
    - submitPriorAuth(), uploadPriorAuthDocument(), checkPriorAuthStatus()
    - fetchPriorAuths(), createPriorAuth(), updatePriorAuth()
  - Enhanced PriorAuthPage UI:
    - "Submit to Payer" button with confirmation
    - Document upload section (clinical notes, labs, photos, treatment history)
    - Status tracking timeline with visual indicators (completed/in_progress/action_required)
    - Real-time status checking with payer
    - Notifications for status changes (success/error/info banners)
    - Response handling for "more info needed" requests
    - Two-column management modal (details + actions)
  - Production-ready features:
    - Document storage integration via existing upload endpoints
    - Notes/history tracking for all actions
    - Approval/denial reasons with timestamps
    - Support for resubmission after more info provided

- ‚úÖ Waitlist with auto-fill and notifications (2025-12-29)
  - Backend endpoints for auto-fill detection and manual notifications
  - SMS, email, and portal notification integration
  - Frontend UI with "Notify Patient" button and notification history
  - Automatic matching based on provider, time preferences, and priority
  - Production-ready with Twilio SMS integration and audit logging

- ‚úÖ Fax Management - FULL IMPLEMENTATION (2025-12-29)
  - Backend: Complete fax routing with all CRUD endpoints
  - GET /api/fax/inbox - list received faxes with filtering (status, patient, date, unread)
  - GET /api/fax/outbox - list sent faxes with status tracking
  - POST /api/fax/send - send faxes (patient chart, documents, referrals)
  - GET /api/fax/:id/pdf - retrieve fax PDF preview
  - PATCH /api/fax/:id - mark as read, assign to patient, add notes
  - DELETE /api/fax/:id - delete fax records
  - GET /api/fax/meta/stats - real-time statistics dashboard
  - POST /api/fax/simulate-incoming - demo mode for testing (admin only)
  - Mock fax service with realistic transmission simulation:
    - 2-second delay for sending faxes
    - 90% success rate with transmission IDs
    - 10% failure rate with error messages
    - Sample incoming faxes (lab results, referrals, insurance auth)
  - Frontend API functions with credentials: 'include':
    - fetchFaxInbox(), fetchFaxOutbox(), fetchFaxStats()
    - sendFax(), updateFax(), deleteFax(), fetchFaxPdf()
    - simulateIncomingFax() for testing
  - Comprehensive FaxPage UI with Inbox/Outbox tabs:
    - Real-time stats cards (unread, total received, sent, failed)
    - Advanced filtering (patient, date range, status, unread only)
    - Search across subject, phone numbers, patient names
    - Send Fax modal with cover page and patient linking
    - Preview modal with PDF viewing capability
    - Assign to patient with notes
    - Mark as read/unread functionality
    - Status badges (received, sending, sent, failed)
    - Phone number formatting and date/time display
    - Inline actions (assign, mark read, delete)
  - Production-ready features:
    - Full patient integration and linking
    - Document attachment support
    - Cover page customization
    - Error handling and retry logic
    - Audit trail for all fax operations
    - Support for encounter and document associations

- ‚úÖ Direct Secure Messaging - FULL IMPLEMENTATION (2025-12-29)
  - Backend: Complete HIPAA-compliant Direct messaging system
  - GET /api/direct/messages - list Direct messages with folder filter (inbox/sent/all)
  - POST /api/direct/send - send Direct message to external provider
  - GET /api/direct/contacts - list external provider directory
  - POST /api/direct/contacts - add external provider contact
  - PATCH /api/direct/messages/:id - mark as read/unread
  - GET /api/direct/messages/:id/attachments - get message attachments
  - GET /api/direct/stats - real-time messaging statistics
  - Mock Direct protocol (simulates secure email exchange):
    - 95% success rate with transmission tracking IDs
    - 5% failure rate with error messages
    - 2-second delivery simulation
    - Sample provider contacts (pathology, rheumatology, Mohs surgery, labs)
  - Database schema with full audit trail:
    - direct_messages table (from/to addresses, subject, body, attachments, status, timestamps)
    - direct_contacts table (provider directory with specialty, organization, Direct address)
    - Status tracking: sent ‚Üí delivered ‚Üí read
    - Reply threading support
    - Transmission ID tracking
  - Frontend API functions with credentials: 'include':
    - fetchDirectMessages(), sendDirectMessage()
    - fetchDirectContacts(), createDirectContact()
    - markDirectMessageRead(), fetchDirectMessageAttachments()
    - fetchDirectStats()
  - Comprehensive DirectMessagingPage UI:
    - Inbox/Sent tabs with real-time stats dashboard
    - Message composition with provider directory lookup
    - Rich text messaging with subject and body
    - Attachment support (patient records, labs, images)
    - Provider directory management:
      - Add external providers with Direct addresses
      - Specialty and organization tracking
      - Phone/fax/address information
      - Favorite providers for quick access
      - Search and filter capabilities
    - Message viewing with delivery tracking:
      - From/to addresses and timestamps
      - Delivered/read status indicators
      - Transmission ID display
      - Attachment download support
      - Error message display for failed sends
    - Advanced filtering and search:
      - Unread messages filter
      - Search across subject, addresses, body
      - Favorite contacts filter
    - Status badges and visual indicators:
      - Unread message dot indicator
      - Delivered/failed status badges
      - Transmission tracking
  - Production-ready features:
    - HIPAA-compliant secure messaging protocol
    - Provider-to-provider communication standard
    - External provider directory management
    - Document attachment handling
    - Read receipts and delivery confirmation
    - Audit logging for all messaging activity
    - Error handling and transmission tracking
    - Reply threading capability

- ‚úÖ Regulatory Reporting / CQM / MIPS - FULL IMPLEMENTATION (2025-12-29)
  - Backend: Complete quality measures tracking and MIPS reporting system
  - Database migration 017_quality_measures_mips with 5 new tables:
    - quality_measures - CQM definitions with numerator/denominator/exclusion criteria
    - measure_performance - calculated performance tracking by provider/period
    - mips_submissions - MIPS submission history with status and scores
    - patient_measure_events - individual patient attribution for quality measures
    - quality_gaps - gap closure opportunities with patient intervention tracking
  - Seeded 7 dermatology-specific quality measures:
    - DERM-001: Melanoma Screening Rate (Preventive Care)
    - DERM-002: Acne Treatment Appropriateness (Clinical Quality)
    - DERM-003: Psoriasis Management and Treatment (Clinical Quality)
    - PREV-001: Diabetic Foot Exam (Preventive Care)
    - DERM-004: Skin Cancer Biopsy Appropriateness (Clinical Quality)
    - DERM-005: Atopic Dermatitis Quality of Life Assessment (Patient Experience)
    - PREV-002: Sunscreen Education for High-Risk Patients (Preventive Care)
  - Backend routes (/api/quality):
    - GET /measures - list available quality measures with category/specialty filters
    - GET /performance - calculate performance with provider/period/measure filters
    - POST /submit - submit MIPS data for quarter with confirmation number
    - GET /reports/mips - generate MIPS report by year/quarter with scores
    - GET /reports/pqrs - generate PQRS report grouped by category
    - GET /gap-closure - identify patients needing interventions with priority
    - POST /gap-closure/:id/close - close quality gap with intervention notes
    - POST /recalculate - recalculate performance for date range
  - Frontend API functions with credentials: 'include':
    - fetchQualityMeasures() - get measures with active/category filters
    - fetchMeasurePerformance() - get performance by year/quarter/provider
    - submitMIPSData() - submit to MIPS with year/quarter/measures
    - fetchMIPSReport() - get MIPS submission history and scores
    - fetchPQRSReport() - get PQRS report by category
    - fetchGapClosureList() - get open gaps with priority/measure filters
    - closeQualityGap() - close gap with intervention notes
    - recalculateQualityMeasures() - trigger performance recalculation
  - Comprehensive QualityPage with 4 tabs:
    - Dashboard:
      - Summary cards (total measures, performance tracked, average performance, open gaps)
      - Bar chart showing performance by measure vs benchmark (80% target)
      - Pie chart of measures by category distribution
      - Performance by category with average calculations
      - Detailed performance table with color-coded rates:
        - Green (‚â•80%): Meeting benchmark
        - Yellow (60-79%): Approaching benchmark
        - Red (<60%): Below benchmark
      - CSV export for all performance data
      - Recalculate button for on-demand updates
    - Gaps:
      - Gap closure opportunities list with priority badges (high/medium/low)
      - Patient information (name, DOB, phone, email)
      - Measure details and gap description
      - Due date tracking
      - Close gap functionality with intervention notes
      - Filters by measure, provider, status, priority
    - Reports:
      - MIPS Quality Report generation
      - PQRS Report with category breakdown
      - Provider Comparison reporting
      - Trend Analysis over time
      - Report cards with descriptions
    - Submit:
      - MIPS Submission Wizard with step-by-step flow
      - Year and quarter selection (required)
      - Provider-specific or practice-wide submission
      - Measure list preview with performance rates
      - Submit to MIPS with confirmation number generation
      - Download report option (CSV format)
  - Advanced filters on all tabs:
    - Year selector (2025, 2024, 2023)
    - Quarter selector (Q1-Q4 or All Year)
    - Provider filter (optional)
    - Measure filter (optional)
  - Production-ready features:
    - Complete audit trail for all submissions and gap closures
    - User attribution (created_by, updated_by, closed_by)
    - Timestamp tracking for all operations
    - Performance rate calculations (numerator/denominator - exclusions)
    - Patient list attribution in performance records (JSONB)
    - Benchmark comparisons (default 80% target)
    - Category-based reporting (Preventive Care, Clinical Quality, Patient Experience)
    - CSV export for performance data
    - MIPS confirmation number generation
    - Gap priority scoring (high/medium/low)
    - Due date tracking for interventions
  - Charting and visualization:
    - Bar charts using Recharts library
    - Performance vs target visualization
    - Pie chart for category distribution
    - Color-coded performance badges
    - Responsive container support
  - Integration points:
    - Links to patient records from gap closure list
    - Measure criteria (ICD-10, CPT codes, exam requirements)
    - Provider productivity tracking
    - Encounter-based measure attribution
  - Compliance and regulatory:
    - MIPS submission tracking with status (draft/submitted)
    - PQRS reporting capability
    - CQM numerator/denominator/exclusion tracking
    - Quality gap closure documentation
    - Provider performance comparison
    - Reporting year tracking (2025 ready)
